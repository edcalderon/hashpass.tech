version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 22.18.0
        - npm install -g npm@latest
        - npm ci
    build:
      commands:
        - npm run build:web
  artifacts:
    baseDirectory: dist/client
    files:
      - '**/*'
    # Include all files from the client directory
    include:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .expo/**/*
  customHeaders:
    - pattern: 'sw.js'
      headers:
        - key: 'Cache-Control'
          value: 'no-cache, no-store, must-revalidate'
        - key: 'Service-Worker-Allowed'
          value: '/'
    - pattern: '**/*.js'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=31536000, immutable'
    - pattern: '**/*.css'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=31536000, immutable'
    - pattern: '**/*.html'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=0, must-revalidate'
  
  # Handle Expo web routing
  redirects:
    - source: '/*'
      status: '200'
      target: '/index.html'
    - source: '/_expo/*'
      status: '200'
      target: '/_expo/'
    - source: '/auth/*'
      status: '200'
      target: '/auth/'
    - source: '/dashboard/*'
      status: '200'
      target: '/dashboard/'
  
  # Custom error responses
  customErrorResponses:
    - errorCode: 404
      responsePagePath: '/+not-found.html'
      responseCode: 200
